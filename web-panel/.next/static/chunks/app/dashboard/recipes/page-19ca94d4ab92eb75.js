(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[916],{5689:function(e,t,n){Promise.resolve().then(n.bind(n,119))},119:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return C}});var a=n(7437),s=n(9693),r=n(2464),i=n(2884),l=n(9116),c=n(2265),d=n(7233),o=n(9178),u=n(4226),m=n(8068),x=n(2489),h=n(9397),p=n(2252),f=n(5317),g=n(7648),N=n(8706);let y=(0,n(9763).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);var j=n(401),v=n(4508);async function b(e){if(!e.trim())return[];try{return(await l.Z.get("/api/ingredients/search?q=".concat(encodeURIComponent(e)))).data.ingredients.map(e=>({id:e.id,canonicalName:e.canonicalName}))}catch(e){return console.error("Failed to search ingredients:",e),[]}}function w(e){let{value:t,onSelect:n,onClear:s,placeholder:r="Search ingredient...",disabled:i=!1,className:l}=e,[d,u]=(0,c.useState)(""),[h,p]=(0,c.useState)([]),[f,g]=(0,c.useState)(!1),[N,w]=(0,c.useState)(!1),[k,Z]=(0,c.useState)(null),I=(0,c.useRef)(null),C=(0,c.useRef)(null);(0,c.useEffect)(()=>{function e(e){I.current&&!I.current.contains(e.target)&&w(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,c.useEffect)(()=>{if(k&&clearTimeout(k),t||!d.trim()){p([]),w(!1);return}g(!0);let e=setTimeout(async()=>{p(await b(d)),g(!1),w(!0)},300);return Z(e),()=>{e&&clearTimeout(e)}},[d,t]);let S=e=>{n(e),u(e.canonicalName),w(!1),p([])};return(0,a.jsxs)("div",{ref:I,className:(0,v.cn)("relative",l),children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:(0,a.jsx)(y,{className:"h-4 w-4"})}),(0,a.jsx)(m.I,{ref:C,type:"text",value:t?t.canonicalName:d,onChange:e=>{let n=e.target.value;u(n),t&&n!==t.canonicalName&&s&&s()},onFocus:()=>{h.length>0&&!t&&w(!0)},onKeyDown:e=>{"Enter"===e.key&&N&&h.length>0&&(e.preventDefault(),S(h[0])),"Escape"===e.key&&w(!1)},placeholder:r,disabled:i||!!t,className:(0,v.cn)("pl-9 pr-9",t&&"pr-9")}),t&&(0,a.jsx)("button",{type:"button",onClick:()=>{var e;u(""),p([]),w(!1),s&&s(),null===(e=C.current)||void 0===e||e.focus()},className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",tabIndex:-1,children:(0,a.jsx)(x.Z,{className:"h-4 w-4"})}),f&&!t&&(0,a.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:(0,a.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"})})]}),N&&!t&&(h.length>0||f)&&(0,a.jsx)(o.Z,{className:"absolute z-50 mt-1 w-full max-h-60 overflow-auto border border-border shadow-lg",children:f?(0,a.jsx)("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"Searching..."}):0===h.length?(0,a.jsx)("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"No ingredients found"}):(0,a.jsx)("div",{className:"py-1",children:h.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>S(e),className:"w-full px-4 py-2 text-left text-sm hover:bg-muted focus:bg-muted focus:outline-none flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex-1",children:e.canonicalName}),(null==t?void 0:t.id)===e.id&&(0,a.jsx)(j.Z,{className:"h-4 w-4 text-primary"})]},e.id))})})]})}function k(e){let{value:t,onChange:n}=e,s=(0,N.T)("recipes");function r(e,a,s){n(t.map((t,n)=>n===e?{...t,[a]:s}:t))}return(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-foreground",children:s("ingredients")}),(0,a.jsxs)("div",{className:"space-y-3",children:[t.map((e,i)=>(0,a.jsxs)("div",{className:"flex flex-col gap-2 p-3 border border-border rounded-md bg-muted/30",children:[(0,a.jsxs)("div",{className:"flex gap-2 items-start",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(w,{value:e.ingredientId?{id:e.ingredientId,canonicalName:e.ingredientName}:null,onSelect:e=>{n(t.map((t,n)=>n===i?{...t,ingredientId:e.id,ingredientName:e.canonicalName}:t))},onClear:()=>{n(t.map((e,t)=>t===i?{...e,ingredientId:"",ingredientName:""}:e))},placeholder:s("ingredientName")})}),t.length>1&&(0,a.jsx)(u.z,{type:"button",variant:"danger",onClick:()=>{n(t.filter((e,t)=>t!==i))},className:"px-3",children:(0,a.jsx)(x.Z,{className:"w-4 h-4"})})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(m.I,{className:"flex-1",placeholder:s("amount"),value:e.amount,onChange:e=>r(i,"amount",e.target.value),type:"number",step:"0.01"}),(0,a.jsx)(m.I,{className:"w-32",placeholder:s("unit"),value:e.unit,onChange:e=>r(i,"unit",e.target.value)}),(0,a.jsx)(u.z,{type:"button",variant:e.isMandatory?"primary":"secondary",onClick:()=>{n(t.map((e,t)=>t===i?{...e,isMandatory:!e.isMandatory}:e))},className:"whitespace-nowrap",children:e.isMandatory?s("mandatory"):s("optional")})]})]},i)),(0,a.jsxs)(u.z,{type:"button",variant:"secondary",onClick:function(){n([...t,{ingredientId:"",ingredientName:"",amount:"",unit:"",isMandatory:!0}])},className:"w-full sm:w-auto",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 mr-2"}),s("addIngredient")]})]})]})}async function Z(){try{return(await l.Z.get("/api/recipes")).data.recipes}catch(e){throw Error((null==e?void 0:e.toString())||"Failed to load recipes")}}async function I(e){return l.Z.post("/api/recipes",e)}function C(){let e=(0,N.T)("recipes"),t=(0,N.T)("common"),n=(0,s.NL)(),{data:l,isLoading:x,error:y,refetch:j}=(0,r.a)({queryKey:["recipes"],queryFn:Z}),[v,b]=(0,c.useState)(""),[w,C]=(0,c.useState)(""),[S,E]=(0,c.useState)([{ingredientId:"",ingredientName:"",amount:"",unit:"",isMandatory:!0}]),M=(0,i.D)({mutationFn:I,onSuccess:()=>{n.invalidateQueries({queryKey:["recipes"]}),b(""),C(""),E([{ingredientId:"",ingredientName:"",amount:"",unit:"",isMandatory:!0}])}}),q=v.trim()&&w.trim()&&S.length>0&&S.every(e=>e.ingredientId)&&!M.isPending;return(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-foreground",children:e("title")}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1",children:e("subtitle")})]})}),(0,a.jsxs)(o.Z,{className:"p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-6",children:e("newRecipe")}),(0,a.jsxs)("form",{className:"flex flex-col gap-4",onSubmit:e=>{if(e.preventDefault(),S.some(e=>!e.ingredientId))return;let t=S.filter(e=>e.isMandatory&&e.ingredientId).map(e=>e.ingredientId),n=S.filter(e=>!e.isMandatory&&e.ingredientId).map(e=>e.ingredientId);M.mutate({name:v,description:w,mandatoryIngredientIds:t,optionalIngredientIds:n,prohibitedIngredientIds:[]})},children:[(0,a.jsx)(m.I,{placeholder:e("recipeName"),value:v,onChange:e=>b(e.target.value),required:!0}),(0,a.jsx)(m.I,{placeholder:e("description"),value:w,onChange:e=>C(e.target.value),required:!0}),(0,a.jsx)(k,{value:S,onChange:E}),(0,a.jsxs)(u.z,{type:"submit",variant:"primary",loading:M.isPending,disabled:!q,className:"w-full sm:w-auto",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 mr-2"}),e(M.isPending?"adding":"addRecipe")]})]})]}),x?(0,a.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,t)=>(0,a.jsxs)(o.Z,{className:"p-4",children:[(0,a.jsx)(d.O,{className:"h-6 w-1/3 mb-2"}),(0,a.jsx)(d.O,{className:"h-4 w-2/3"})]},t))}):y?(0,a.jsxs)(o.Z,{className:"p-6 text-center",children:[(0,a.jsx)(p.Z,{className:"w-12 h-12 mx-auto mb-4 text-destructive"}),(0,a.jsx)("p",{className:"text-destructive",children:e("failedToLoad")}),(0,a.jsx)(u.z,{variant:"secondary",onClick:()=>j(),className:"mt-4",children:t("retry")})]}):l&&0!==l.length?(0,a.jsx)("div",{className:"space-y-4",children:l.map(e=>(0,a.jsx)(o.Z,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-1",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description})]}),(0,a.jsx)(g.default,{href:"/dashboard/recipes/".concat(e.id),children:(0,a.jsx)(u.z,{variant:"secondary",className:"ml-4",children:"View"})})]})},e.id))}):(0,a.jsxs)(o.Z,{className:"p-12 text-center",children:[(0,a.jsx)(f.Z,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:e("noRecipes")}),(0,a.jsx)("p",{className:"text-muted-foreground",children:e("noRecipesDescription")})]})]})}},2252:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});let a=(0,n(9763).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},5317:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});let a=(0,n(9763).Z)("ChefHat",[["path",{d:"M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z",key:"z3ra2g"}],["line",{x1:"6",x2:"18",y1:"17",y2:"17",key:"12q60k"}]])},2489:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});let a=(0,n(9763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},8706:function(e,t,n){"use strict";n.d(t,{T:function(){return r}});var a=n(1675);function s(e,t){return(...e)=>{try{return t(...e)}catch{throw Error(void 0)}}}let r=s(0,a.T_);s(0,a.Gb)}},function(e){e.O(0,[675,311,648,464,297,971,117,744],function(){return e(e.s=5689)}),_N_E=e.O()}]);